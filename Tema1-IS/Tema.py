
init_string = "123456789Andreea"
plaintext = "It was my second day on the job. "
key = '01101001011011000110111101110110011001010111100101101111011101010110100101101100011011110111011001100101011110010110111101110101'


_xormap = {('0', '1'): '1', ('1', '0'): '1', ('1', '1'): '0', ('0', '0'): '0'}
def xor(x, y):
    return ''.join([_xormap[a, b] for a, b in zip(x, y)])

def init_iv(init_string):
    iv = ""
    for char in init_string:
        aux = format(ord(char),'b')
        while len(aux) != 8:
            aux = '0' + aux
        iv+=aux
    return iv

iv = init_iv(init_string)


def bin_to_char(text):
    list_num = []
    sstr = ""
    for char_128 in text:
        while char_128 !="":
            #print("char_8: ", char_128[:8])
            list_num.append(int(char_128[:8],2))
            #print("char_128: ", char_128)
            char_128 = char_128[8:]
    for num in list_num:
        sstr+=chr(num)
    return sstr

def divide_plaintext(plaintext):
    list = []
    list_aux = []
    num = 0
    for char in plaintext:
        list_aux.append(ord(char))
        num += 1
        if num == 16:
            num = 0
            list.append(list_aux)
            list_aux = []
    if num!=0:
        for i in range(num,16):
            list_aux.append(ord(" "))
        list.append(list_aux)
    return list

def divided_plaintext_to_binary(text):
    bin_list = []
    for list in text:
        char_128 = ""
        for char in list:
            char_8 = (format(char,'b'))
            while len(char_8) != 8:
                char_8='0' + char_8
            char_128 += char_8
        bin_list.append(char_128)
        char_128 = ""
    return bin_list

def CBC(key,init_iv,plaintext):

    divided_plaintext = divide_plaintext(plaintext)                #"""divide the plaintext in 8 characters"""
    bin_plaintxt = divided_plaintext_to_binary(divided_plaintext)  #"""turns the 8 characters in bits"""
    char_128 = bin_plaintxt[0]                                                      #"""takes the first 8 sets of bits and XORes them with iv and encryptes them with a key """
    #print("plaintx: ", bin_plaintxt)
    #print("char_128: ", char_128)
    #print("init_iv: ", init_iv)
    xor1 = xor(char_128,init_iv)
    #print("xor1: ", xor1)
    #print("key: ", key)
    cyper = xor(xor1,key)
    #print("new_cyper: ", cyper)                                                         #"""adding the cypher to a list and poping the first elemenet from the plaintext(the first 8 chars)"""
    cyper_list = [cyper]
    bin_plaintxt.pop(0)
    #print("bin_plaintxt: ", bin_plaintxt)

    for char_128 in bin_plaintxt:
        #print("char_128: ", char_128)
        #print("old_cyper: ", cyper)
        xor1 = xor(char_128,cyper)
        #print("xor1: ", xor1)
        #print("key: ", key)
        cyper = xor(xor1, key)
        #print("new_cyper: ", cyper)
        cyper_list.append(cyper)

    #print("cyper_list: ", cyper_list)
    return cyper_list

""" CBC + decr_CBC return a list each """

def decr_CBC(key,iv,cyper_list):
    cyper_128 = cyper_list.pop(0)
    #print("cyper_128: ",cyper_128)
    #print("key: ", key)
    xor1 = xor(cyper_128,key)
    #print("xor1: ", xor1)
    #print("iv: ", iv)
    plain_txt = xor(xor1,iv)
    #print("new_plain_txt: ", plain_txt)
    plain_list = [plain_txt]
    #cyper_list.pop(0)
    prev_cyper_128 = cyper_128
    #print("prev_cyper_128: ",prev_cyper_128)

    for cyper_128 in cyper_list:
        #print("cyper_128: ", cyper_128)
        #print("key: ", key)
        xor1 = xor(cyper_128,key)
        #print("xor1: ", xor1)
        #print("prev_cyper_128: ", prev_cyper_128)
        plain_txt = xor(xor1, prev_cyper_128)
        #print("new_plain_txt: ", plain_txt)
        prev_cyper_128 = cyper_128
        plain_list.append(plain_txt)

    return plain_list


"""encryption = CBC(key,iv,plaintext)
print("encryption: ", encryption)
decryption = decr_CBC(key,iv,encryption)
print("decryption: ", decryption)


print(bin_to_char(encryption))
print(bin_to_char(decryption))"""

def OFB(key,init_iv,plaintext):

    divided_plaintext = divide_plaintext(plaintext)                #divide the plaintext in 8 characters
    bin_plaintxt = divided_plaintext_to_binary(divided_plaintext)  #turns the 8 characters in bits
    char_128 = bin_plaintxt.pop(0)                                                    #takes the first 8 sets of bits and XORes them with iv and encryptes them with a key
    #print("plaintx: ", bin_plaintxt)
   # print("key: ", key)
   # print("init_iv: ", init_iv)
    xor1 = xor(key,init_iv)
   #print("xor1: ", xor1)
    #print("char_128: ", char_128)
    cyper = xor(xor1,char_128)
   # print("new_cyper: ", cyper)                                                         #adding the cypher to a list and poping the first elemenet from the plaintext(the first 8 chars)
    cyper_list = [cyper]
   #print("bin_plaintxt: ", bin_plaintxt)

    for char_128 in bin_plaintxt:
        #print("key: ", key)
        #print("old_xor1: ", xor1)
        xor1 = xor(key, xor1)
        #print("xor1: ", xor1)
        #print("char_128: ", char_128)
        cyper = xor(xor1, char_128)
        #print("new_cyper: ", cyper)
        cyper_list.append(cyper)

    #print("cyper_list: ", cyper_list)
    return cyper_list

def decr_OFB(key,iv,cyper_list):
    cyper_128 = cyper_list.pop(0)
    #print("iv: ", iv)
    #print("key: ", key)
    xor1 = xor(iv,key)
    #print("xor1: ", xor1)
   # print("cyper_128: ", cyper_128)
    plain_txt = xor(xor1,cyper_128)
    #print("new_plain_txt: ", plain_txt)
    plain_list = [plain_txt]
    prev_xor = xor1

    for cyper_128 in cyper_list:
        #print("cyper_128:", cyper_128)
        #print("key: ", key)
       # print("old_xor1 ", xor1)
        xor1 = xor(key, xor1)
        #print("xor1: ", xor1)
        #print("cyper_128: ", cyper_128)
        plain_txt = xor(xor1, cyper_128)
        #print("new_plain_txt: ", plain_txt)
        plain_list.append(plain_txt)

    return plain_list

"""encryption1 = OFB(key,iv,plaintext)
print("encryption: ", encryption1)
decryption1 = decr_OFB(key,iv,encryption1)
print("decryption: ", decryption1)


print("enc_OFB: ", bin_to_char(encryption1))
print("decr_OFB: ", bin_to_char(decryption1))

"""

def char_to_bin(text):
    str_bin = ""
    for char in text:
        aux = format(ord(char), 'b')
        while len(aux)!=8:
            aux= '0' + aux
        str_bin += aux
    return str_bin

#print(char_to_bin("/O+DgHDQPVoVCGfF"))

list = ['00100001001011100101111100001111000101100011110101010001001100000111011001010101011100000111010000111010011010000110010000110001', '01011000001000100111001000111010011101000010101001111001011101010011010000001001011110000010000101111011011001010110100100101011', '00100001000000110001111000000001010101110010000100011111011000110110101101001001011000010011110100111110011000000010011001110110', '00010110010010110011111100110100001101010010101000111100011000110011000000010100011000100010111101111001011110110110100100100101', '00100110010011110001011100011101000100110111001000011001011100110110010001001001011011000011011000110111001101010010011001111110', '00001001010000100010100100111101001111100110010100110100011111110011110000011010001000010000111001111101001110010010000100101011', '00100100010111100000010000011111010100000011110100010011011101000110111000001110001111000001001000111000001110000010011001110110', '00010011010100010110100000111110011010110110010100100111011110000011111101010010001001010100011101110010001010000010010001100010', '00111110010101100000010000011111010010000111011000000100001111010111101000010011001110100101011101111001001000110011111101110110', '00010000010111110011101101110011011110000110101100100011001101000110001000000111000111100000001000111110001000000011111000100110', '00101100010100110101011101011110010101000011001100001100001111110010000001010110000000010001100101100110001010100011100001100010', '01010101010110100110111100110010010101010010010000100100001111100111001101000010001000100000110100111110001111000111011100000010', '01111110010100110101010100011011011110110011100100010000011101010110010100110011001110010001110101100111001001110011100001010111', '01010100010010110111000000100101010100000010111100110001001100000010010001110101001111010001110000101001001101110111011100101010', '00101101010010110101110100011111011101110111011100010010001000110111011100110011011100000000001001101100001110100110111101110000', '01010100010100000111010000110000010001110110101000100000001010100011100000100111011110010000010100100010001110010110110100110000', '00101101010101110101111001011100011001000111110001000110000011100110000001100111011111000001111101100111001000100010001001000110', '00011011010010100110000001110100010001110110110101101110010010110011101000111010011101110000111100111111001101000011010000011110', '00100111000011000000110001101100011101110111010001011110010010110110000000101110011011100001001001110001011101100010110001000101', '00001100000010000010010000000000010101000110001001111100000011100010000101101000011010100001001100111111001101000010001000010011', '00111010000101010001110001101100011111110110111001001001010010110111101000110011011101000001001000110100001101010010001001001011', '00001100000011110011011001010101010100010011011001111111010000010010111101101100011111000001001101101100011110010110110100101000', '00111101000000100001010000111001011111100011011100011001010101000111000100110111011111110000001101100111011010010110001101110010', '00000011010001100111100000010100010100100010101101111111010110000011001100100011011001010001011100111111001010110100000100101001', '00110111000011100100000000111101011111000011111101010000010100110110001000110111011001010000011100110100000011010100111101111001', '01001110000011100110110100010101000111100010011000110110010111100011000101100010011110100000011000111111000011100101010000111001', '01110110000001010100101001110111011111000001011000010101000110110110001100111111011100110101001101111010000000110100111100101101', '01000010000011000110110101011110000111100000011100100111010100000111010101000010001111100100000000110100000011010101010000111001', '01111010000101110000000101100110001101000001000000010100010100100010101101010110001001110101110101111010010011110100101101101000', '01010001000110010010100001001001000000100000010000101011000101110111111000000011001110000101100000110100010110010100000100111000', '00101000000101110000100001101010001011110000111000011110010100100010000001010110001100010000110101111011010010010100000101111100', '00000001000110100010000000000110000000100000001100101100000101110111000000010000001100110001010101110000010111100100000000101100', '00111101000000000100110000100111001001010101010101001010001111000010100101010011011111100001010000110011010111010101101100111000', '00101101010010000110100000001010000100010100100000101100001110100111000000001010011101100100000101110111010010100100000000101100', '00000000010010000100000101100110001111000100010000000010001110100011010000011110011010000101110100111000010011010000001100111000', '00010000000000000111111101001111000111110101000000101101001001010110011100001010010000010100100101110111000011110000000001101001', '00101111000111000001001101101110001110000000100000011100001010010010010101010110000011000101110101111100000001010000101000111011', '00000010000011010111111101010001000011100001000100111001001001110011001100001101000001110000100000100011000000100000010001101100', '00110011000011000101110101111010001111110100011101011111000010100110000001001011000011110101110101101001000100100000111001111000', '00011110000011000110001101010011000110000001111101110000000010110011001100011110000011100101101101100010001110010100000100100111', '00101001000010110101100000111111001100100000001000010110000110010110101001011111000011110100101001101001001100110100111101100101', '00010101010000110111100000011010000110110001111100110100010111000011101000000100000100000001111100101111001101000000000000100101', '00100011000010110101000100111011001110110001010100010011010110100110100100011110010111010100101000100100011101100100111100110001']
k = '01011001011010000100110001001100010000100111100001000110011001010011011000110100011011010111010100101011011000100110111100110100'
iv = '00110001001100100011001100110100001101010011011000110111001110000011100101000001011011100110010001110010011001010110010101100001'
#print((bin_to_char(decr_CBC(k,iv,list))))